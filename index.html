// This code adds a filter to hide limited access highways using the AccessCont field values

// Step 1: Add this button to your filter buttons section:

<div class="filter-buttons" style="margin-top: 10px;">
    <div class="filter-label">Road Type Filter:</div>
    <button class="filter-button" id="hideHighAccessBtn">Hide Limited Access Highways</button>
</div>

// Step 2: Add this variable to your global variables:

let hideHighAccessRoads = false;

// Step 3: Add this setup function:

function setupAccessControlFilter() {
    const hideHighAccessBtn = document.getElementById('hideHighAccessBtn');
    if (!hideHighAccessBtn) return;
    
    hideHighAccessBtn.addEventListener('click', function() {
        hideHighAccessRoads = !hideHighAccessRoads;
        
        // Update button appearance
        if (hideHighAccessRoads) {
            this.classList.add('active');
            this.textContent = 'Show Limited Access Highways';
        } else {
            this.classList.remove('active');
            this.textContent = 'Hide Limited Access Highways';
        }
        
        // Update the map
        if (pointsData && pointsData.length > 0 && map && deckOverlay) {
            createDeckLayer();
        }
    });
}

// Step 4: Call this in your initialize function:
// setupAccessControlFilter();

// Step 5: Update your filterData function to include the access control filter:

function filterData() {
    const minRank = parseInt(document.getElementById('rankMin').value);
    const maxRank = parseInt(document.getElementById('rankMax').value);
    
    if (!pointsData) return [];
    
    return pointsData.filter(point => {
        if (!point || !point.position || !Array.isArray(point.position) || point.position.length !== 2) return false;
        
        // Apply rank filter
        const rank = point.DemandRank;
        const rankMatch = typeof rank === 'number' && !isNaN(rank) && rank >= minRank && rank <= maxRank;
        
        // Apply sidewalk filter
        let sidewalkMatch = true;
        if (currentSidewalkFilter === 'yes') {
            sidewalkMatch = point.Sidewalks === 1;
        } else if (currentSidewalkFilter === 'no') {
            sidewalkMatch = point.Sidewalks === 0;
        }
        
        // Apply town filter
        let townMatch = true;
        if (currentTownFilter !== 'all') {
            townMatch = point.town === currentTownFilter;
        }
        
        // Apply access control filter using AccessCont values
        let accessControlMatch = true;
        if (hideHighAccessRoads) {
            // Filter out high access control roads (codes 1-4 represent full control)
            // Code 1: Full Control Parkways
            // Code 2: Full Control - Other Divided Highways, 4+ lanes
            // Code 3: Full Control - Divided, 2 lanes
            // Code 4: Full Control - Undivided Highways
            
            const accessCode = point.AccessCont;
            // Check if it's one of the full control types (1-4)
            accessControlMatch = !(accessCode >= 1 && accessCode <= 4);
        }
        
        // Point must match all filters
        return rankMatch && sidewalkMatch && townMatch && accessControlMatch;
    });
}

// Step 6: Add a log message when filtering to verify the access control filter is working:

function createDeckLayer() {
    const filteredData = filterData();
    
    // Log statistics about filtered data
    if (hideHighAccessRoads) {
        const totalPoints = filteredData.length;
        const accessCounts = {};
        
        // Count points by access control type
        filteredData.forEach(point => {
            const accessCode = point.AccessCont;
            accessCounts[accessCode] = (accessCounts[accessCode] || 0) + 1;
        });
        
        console.log(`Filtered out limited access highways. Remaining points: ${totalPoints}`);
        console.log('Points by access control type:', accessCounts);
    }
    
    // Rest of your existing createDeckLayer function...
}
